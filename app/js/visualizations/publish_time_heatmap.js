(function() {
    const weekdayVsHour = [
        [13, 4, 557166155],
        [13, 0, 363968930],
        [15, 6, 368367208],
        [14, 6, 387260154],
        [7, 3, 272132014],
        [3, 0, 300625303],
        [19, 6, 464465197],
        [16, 6, 420958322],
        [10, 4, 538262252],
        [15, 4, 525371742],
        [11, 6, 461720458],
        [12, 6, 352404375],
        [12, 5, 373253569],
        [18, 6, 424635575],
        [21, 6, 384415501],
        [10, 0, 470388041],
        [8, 6, 174163564],
        [17, 6, 471416902],
        [7, 0, 220309129],
        [22, 4, 325254882],
        [20, 5, 403629037],
        [0, 6, 265967561],
        [13, 6, 389243174],
        [15, 5, 438589684],
        [23, 6, 356746340],
        [4, 6, 120945527],
        [1, 0, 281386280],
        [21, 0, 323242648],
        [1, 5, 206740073],
        [14, 4, 522783307],
        [2, 5, 152620047],
        [11, 0, 412156758],
        [10, 6, 409798336],
        [8, 0, 317677918],
        [11, 4, 580748422],
        [12, 0, 405047135],
        [0, 0, 350903386],
        [22, 6, 425087841],
        [12, 4, 606132469],
        [13, 5, 423686243],
        [15, 0, 429463069],
        [11, 5, 371699391],
        [18, 3, 618373382],
        [9, 4, 377108999],
        [9, 0, 355797369],
        [1, 6, 204183846],
        [23, 5, 394210841],
        [19, 4, 520976344],
        [2, 3, 241561904],
        [3, 6, 134270152],
        [13, 3, 549756597],
        [16, 5, 422661866],
        [4, 5, 110321379],
        [20, 6, 507556276],
        [9, 6, 200178631],
        [18, 1, 577719228],
        [2, 4, 250226776],
        [7, 6, 198303975],
        [19, 3, 542494321],
        [1, 4, 353394713],
        [5, 6, 167791385],
        [7, 5, 192997313],
        [2, 0, 215983295],
        [14, 5, 399350407],
        [2, 6, 147595725],
        [10, 3, 476093235],
        [21, 5, 366979326],
        [16, 0, 481871449],
        [18, 5, 353544211],
        [15, 3, 519971657],
        [17, 2, 512803465],
        [3, 5, 105306243],
        [8, 4, 298029803],
        [22, 3, 385219174],
        [1, 3, 243640141],
        [20, 0, 345919338],
        [0, 1, 355402247],
        [4, 1, 243607091],
        [11, 1, 479645212],
        [8, 1, 273887371],
        [16, 1, 610036791],
        [14, 1, 446653434],
        [13, 1, 466592935],
        [12, 1, 550842458],
        [22, 0, 364454265],
        [17, 0, 574688823],
        [7, 1, 266241119],
        [21, 1, 378650009],
        [18, 2, 644072410],
        [9, 1, 438864720],
        [3, 2, 221923338],
        [10, 1, 462625495],
        [23, 0, 390915705],
        [1, 1, 169248501],
        [17, 1, 543060059],
        [15, 1, 507333777],
        [2, 1, 167042659],
        [22, 1, 347062177],
        [6, 1, 259820353],
        [19, 0, 394668334],
        [20, 1, 377032497],
        [18, 0, 542404768],
        [5, 0, 223528774],
        [3, 1, 264370781],
        [5, 1, 198056723],
        [23, 1, 355605323],
        [19, 1, 492756266],
        [10, 2, 420315360],
        [15, 2, 475315206],
        [5, 2, 156541647],
        [2, 2, 175734040],
        [0, 2, 315683640],
        [12, 2, 509129559],
        [4, 2, 164912796],
        [8, 2, 382441945],
        [16, 2, 481738408],
        [13, 2, 486691698],
        [9, 2, 402662935],
        [19, 2, 536340241],
        [1, 2, 188505873],
        [11, 2, 382055472],
        [7, 2, 237141833],
        [14, 2, 481758547],
        [20, 2, 403837050],
        [23, 2, 411744927],
        [17, 3, 536601641],
        [3, 3, 189709729],
        [12, 3, 488915565],
        [21, 3, 408540823],
        [9, 3, 340313956],
        [4, 3, 126731370],
        [11, 3, 407990442],
        [0, 3, 325645043],
        [8, 3, 296264541],
        [0, 4, 595311937],
        [16, 3, 546791864],
        [23, 3, 505861563],
        [5, 3, 175339706],
        [22, 2, 332250094],
        [14, 3, 445023342],
        [6, 3, 223736174],
        [4, 4, 286983372],
        [18, 4, 810754909],
        [7, 4, 506763836],
        [5, 4, 427563925],
        [3, 4, 279588304],
        [16, 4, 544075876],
        [21, 4, 367867604],
        [6, 4, 791605334],
        [17, 4, 599015916],
        [0, 5, 314419113],
        [10, 5, 400954493],
        [9, 5, 240680809],
        [8, 5, 171400670],
        [23, 4, 293691485],
        [17, 5, 355948222],
        [22, 5, 496746221],
        [5, 5, 88964422],
        [19, 5, 450939552],
        [6, 5, 142296759],
        [6, 0, 214384900],
        [14, 0, 367585705],
        [4, 0, 268405114],
        [6, 6, 118543785],
        [20, 3, 410708238],
        [20, 4, 327216266],
        [21, 2, 326102711],
        [6, 2, 236445070]
        ]

    const monthVsHour = [
        [13, 11, 341793755],
        [15, 11, 300881891],
        [14, 11, 287110668],
        [7, 11, 200036553],
        [3, 11, 78263808],
        [19, 11, 357007293],
        [16, 11, 347118092],
        [10, 11, 272314061],
        [11, 11, 265462557],
        [12, 11, 329510418],
        [18, 11, 342593365],
        [21, 11, 182309126],
        [8, 11, 203165111],
        [17, 11, 263584474],
        [22, 11, 262113127],
        [20, 11, 247062048],
        [0, 11, 150383834],
        [23, 11, 191204402],
        [4, 11, 134835817],
        [1, 11, 140869603],
        [21, 10, 37627],
        [2, 11, 137507789],
        [15, 10, 234649],
        [9, 11, 199754365],
        [2, 2, 173841663],
        [5, 11, 111111988],
        [15, 12, 443477645],
        [17, 9, 313519],
        [18, 9, 134298],
        [6, 11, 279807687],
        [12, 10, 287771],
        [22, 12, 353698866],
        [22, 3, 371629529],
        [16, 10, 4385013],
        [1, 3, 243707363],
        [4, 10, 426284],
        [22, 9, 585832],
        [11, 12, 365804063],
        [12, 12, 434121596],
        [8, 12, 177207507],
        [10, 12, 463107848],
        [0, 12, 290039378],
        [1, 12, 192330533],
        [16, 12, 439840516],
        [9, 12, 287853837],
        [19, 12, 500004078],
        [14, 12, 411406257],
        [20, 12, 419472274],
        [17, 12, 467698888],
        [2, 12, 207613613],
        [21, 12, 324100111],
        [7, 12, 211771267],
        [5, 12, 88753843],
        [13, 12, 433086217],
        [6, 12, 153867451],
        [3, 12, 234656120],
        [20, 2, 357582397],
        [18, 12, 537111177],
        [4, 12, 202218487],
        [4, 5, 234447224],
        [0, 5, 471657796],
        [23, 12, 290244866],
        [16, 2, 450175172],
        [8, 4, 263864418],
        [9, 9, 169391],
        [21, 9, 403998],
        [5, 1, 129972642],
        [1, 8, 140460],
        [0, 1, 330118215],
        [15, 1, 354774484],
        [3, 1, 130918755],
        [1, 1, 236582457],
        [7, 1, 275389425],
        [11, 1, 336932061],
        [2, 1, 97280644],
        [4, 1, 234533518],
        [17, 1, 461234097],
        [16, 1, 463193729],
        [10, 1, 447027058],
        [19, 1, 452750502],
        [14, 1, 425768936],
        [6, 1, 198150977],
        [8, 1, 260862362],
        [22, 1, 314805730],
        [12, 1, 380065818],
        [13, 1, 412264827],
        [21, 1, 302251239],
        [23, 1, 247611486],
        [9, 1, 247413412],
        [20, 4, 311190565],
        [18, 1, 469393354],
        [20, 1, 361841520],
        [2, 4, 168710076],
        [0, 9, 127408],
        [14, 7, 1188806],
        [6, 9, 112320],
        [15, 2, 492696327],
        [18, 2, 418212817],
        [10, 2, 370535588],
        [9, 2, 268735928],
        [13, 2, 363019715],
        [12, 2, 374670946],
        [11, 2, 347770753],
        [3, 2, 175879744],
        [21, 2, 315288756],
        [14, 2, 370755895],
        [17, 2, 400484427],
        [7, 2, 264325013],
        [4, 2, 183373161],
        [22, 2, 397306177],
        [19, 2, 474665699],
        [15, 6, 214519770],
        [8, 2, 274896739],
        [1, 2, 257799138],
        [6, 2, 295250402],
        [0, 2, 352402171],
        [5, 2, 179276665],
        [23, 2, 398168618],
        [18, 10, 452278],
        [19, 10, 338508],
        [1, 9, 59167],
        [2, 10, 8051979],
        [0, 3, 400214407],
        [2, 3, 159556143],
        [18, 7, 50347],
        [10, 3, 447354639],
        [14, 3, 417408928],
        [16, 3, 445468890],
        [12, 3, 431732970],
        [18, 3, 578957835],
        [19, 3, 468975527],
        [9, 3, 325511041],
        [4, 3, 154647014],
        [20, 3, 419673171],
        [21, 3, 382777614],
        [8, 3, 269719512],
        [7, 3, 305220260],
        [15, 3, 509395176],
        [13, 3, 476712742],
        [23, 3, 359932949],
        [11, 3, 404599775],
        [3, 3, 247734612],
        [17, 3, 523241080],
        [5, 3, 238032504],
        [6, 3, 419047723],
        [0, 4, 319910787],
        [11, 4, 575719676],
        [10, 4, 453576515],
        [16, 4, 467705916],
        [15, 4, 421952173],
        [13, 4, 393688456],
        [5, 4, 283769464],
        [12, 4, 471402458],
        [21, 4, 338479172],
        [9, 4, 414937964],
        [22, 4, 359066676],
        [18, 4, 589626362],
        [17, 4, 616536971],
        [7, 4, 247123372],
        [23, 4, 340853498],
        [3, 4, 216074112],
        [14, 4, 425454724],
        [4, 4, 112243779],
        [19, 4, 388646475],
        [6, 4, 193320797],
        [1, 4, 209575340],
        [10, 5, 531579659],
        [11, 5, 589701527],
        [15, 5, 525717291],
        [12, 5, 628748606],
        [14, 5, 513577560],
        [6, 5, 318335475],
        [3, 5, 295440578],
        [5, 5, 340073917],
        [16, 5, 641910361],
        [1, 5, 202722840],
        [18, 5, 750026115],
        [9, 5, 438918435],
        [20, 5, 453831381],
        [8, 5, 293507177],
        [13, 5, 604311366],
        [19, 5, 534667481],
        [7, 5, 266759643],
        [21, 5, 478679647],
        [23, 5, 582491864],
        [17, 5, 620725574],
        [2, 5, 283336335],
        [22, 5, 447789527],
        [0, 6, 207987464],
        [1, 6, 163300522],
        [4, 6, 63289806],
        [11, 6, 206095820],
        [6, 6, 128616091],
        [2, 6, 114666638],
        [13, 6, 210643796],
        [18, 6, 284940364],
        [14, 6, 197529284],
        [8, 6, 169948207],
        [12, 6, 235044451],
        [3, 6, 116459028],
        [21, 6, 231211277],
        [16, 6, 247689521],
        [23, 6, 298068759],
        [10, 6, 192732670],
        [19, 6, 225369679],
        [9, 6, 172276875],
        [17, 6, 239625249],
        [7, 6, 123180269],
        [20, 6, 205010652],
        [5, 6, 66765833],
        [22, 6, 168884921],
        [9, 8, 24468],
        [5, 10, 1138],
        [4, 9, 1891559],
        [16, 9, 10268],
        [3, 8, 16764],
        [2, 9, 199566],
        [14, 10, 141380],
        [12, 7, 51075],
        [20, 10, 58063],
        [13, 10, 79013],
        [13, 8, 43281],
        [19, 8, 102732],
        [22, 7, 51377],
        [19, 9, 66602],
        [0, 8, 267824],
        [11, 8, 852343],
        [8, 9, 110548],
        [9, 10, 11703],
        [17, 7, 62705],
        [19, 7, 45679],
        [16, 7, 626447],
        [13, 9, 1451007],
        [20, 7, 167160],
        [12, 9, 89021],
        [21, 8, 193173],
        [15, 7, 618987],
        [11, 7, 1611801],
        [23, 9, 119477],
        [7, 8, 83417],
        [20, 8, 6012],
        [11, 9, 1439974],
        [22, 10, 53684],
        [0, 10, 207079],
        [6, 10, 323452],
        [14, 8, 22420],
        [15, 8, 143950],
        [23, 7, 76112],
        [21, 7, 66882],
        [8, 10, 208806],
        [17, 8, 19225],
        [22, 8, 89208],
        [8, 8, 359317],
        [20, 9, 3459],
        [13, 7, 11557],
        [0, 7, 16564],
        [10, 7, 17973],
        [11, 10, 25805],
        [14, 9, 50038],
        [10, 8, 42812],
        [5, 9, 28588],
        [3, 7, 280896],
        [23, 8, 4153],
        [10, 10, 34717],
        [1, 7, 12004],
        [18, 8, 6171],
        [17, 10, 8819],
        [8, 7, 16108],
        [16, 8, 10651],
        [3, 10, 69433],
        [10, 9, 113672]
    ]

    function calcValBoundaries(dataset) {
        const allValues = dataset.map(e => e[2])
        return [Math.min(...allValues), Math.max(...allValues)]
    }

    const valueBoundariesWeekday = calcValBoundaries(weekdayVsHour)
    const valueBoundariesMonth = calcValBoundaries(monthVsHour)

    var PublishTimeHeatmap = {};

    var Weekdays = [
        "Monday",
        "Tueseday",
        "Wednesaday",
        "Thursday",
        "Friday",
        "Saturday",
        "Sunday"
    ]

    var Months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    ]

    PublishTimeHeatmap.drawLegend = function(selector, fromColor, toColor, fromVal, toVal) {
        var width = 200
        var height = 10
        var svg = d3.select(selector)

        var defs = svg.append("defs");

        var gradient = defs.append("linearGradient")
           .attr("id", "svgGradient")
           .attr("x1", "0%")
           .attr("x2", "100%")
           .attr("y1", "0%")
           .attr("y2", "0%");

        gradient.append("stop")
           .attr('class', 'start')
           .attr("offset", "0%")
           .attr("stop-color", fromColor)
           .attr("stop-opacity", 1);

        gradient.append("stop")
           .attr('class', 'end')
           .attr("offset", "100%")
           .attr("stop-color", toColor)
           .attr("stop-opacity", 1);

        svg.append("rect")
            .attr("d", function () {} )
            .attr("fill", "url(#svgGradient)")
            .attr("width", width)
            .attr("height", height)
            .attr("x", 510)
            .attr("y", 350);

        svg.append("text")
            .attr("x", 470)
            .attr("y", 360)
            .text(fromVal)
            .attr("font-size", "12px")
            .attr("fill", "#ffffff")

        svg.append("text")
            .attr("x", 720)
            .attr("y", 360)
            .text(toVal)
            .attr("font-size", "12px")
            .attr("fill", "#ffffff")
    }

    function drawHeatmap(selector, vLabels, hLabels, valueBoundaries, data, legendMin, legendMax) {
        var margin = {top: 0, right: 0, bottom: 80, left: 70},
            width = $(selector).width() - margin.left - margin.right,
            height = $(selector).height() - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select(selector)
            // .append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Build X scales and axis:
        var x = d3.scaleBand()
            .range([0, width])
            .domain(hLabels);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .attr("class", "axisWhite")
            .call(d3.axisBottom(x))

        // Build X scales and axis:
        var y = d3.scaleBand()
            .range([0, height])
            .domain(vLabels);

        svg.append("g")
            .attr("class", "axisWhite")
            .call(d3.axisLeft(y));

        // Build color scale
        var colorScale = d3.scaleLinear()
            .range(["#f5fd71", "rgb(250, 119, 53)"])
            .domain(valueBoundaries)

        //Read the data
        //d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/heatmap_data.csv", function(data) {

        svg.selectAll()
            .data(data)
            .enter()
            .append("rect")
            .attr("x", (d) => x(d[0]))
            .attr("y", (d) => y(vLabels[d[1]]))
            .attr("width", x.bandwidth() )
            .attr("height", y.bandwidth() )
            .style("fill", (d) => colorScale(d[2]))

        PublishTimeHeatmap.drawLegend(selector, "#f5fd71", "#ff0000", legendMin, legendMax)
    }

    PublishTimeHeatmap.drawWeekday = function(selector) {
        drawHeatmap(selector, Weekdays, [...Array(24).keys()], valueBoundariesWeekday, weekdayVsHour, "90M", "900M")
    }

    PublishTimeHeatmap.drawMonth = function(selector) {
        drawHeatmap(selector, Months, [...Array(24).keys()], valueBoundariesMonth, monthVsHour, "1,000", "750M")
    }

    this.PublishTimeHeatmap = PublishTimeHeatmap
})();
